<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynergyRecycle.B - Cambia il Futuro</title>
    <style>
        /* Variabili */
        :root {
            --primary-blue: #3a7c8c;
            --blockchain-blue: #4c7f9c;
            --tertiary-green: #c2e6c0;
            --background-green: #f5f9f5;
            --primary-color: #006565;
            --secondary-color: #008F8F;
            --light-color: #EFFBFB;
            --accent-color: #1DC973;
        }

        /* Reset e base */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif; 
            background-color: var(--background-green);
            overflow-x: hidden;
        }

        /* Header e navigazione */
        header {
            background: linear-gradient(135deg, var(--primary-blue), var(--blockchain-blue));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 40px;
            margin-right: 10px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }
        
        .logo:hover img {
            transform: scale(1.05);
        }

        .main-nav {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            width: 70%;
        }

        .main-nav a.button {
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            color: white;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .main-nav a.button:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .main-nav a.button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--tertiary-green);
            transition: width 0.3s ease;
        }
        
        .main-nav a.button:hover::after {
            width: 100%;
        }

        /* Bottone speciale per cambiare il futuro */
        .main-nav a.future-button {
            background-color: var(--accent-color);
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: all 0.4s ease;
            margin-right: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .main-nav a.future-button:hover {
            padding: 8px 25px;
            background-color: #23dd84;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .main-nav a.future-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background-color: white;
            transition: width 0.3s ease;
        }
        
        .main-nav a.future-button:hover::after {
            width: 100%;
        }

        /* Menu mobile */
        .hamburger-btn {
            display: none;
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
        }

        .mobile-nav {
            display: none;
            flex-direction: column;
            background: linear-gradient(135deg, var(--primary-blue), var(--blockchain-blue));
            padding: 15px;
            border-radius: 0 0 10px 10px;
            margin-top: -10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .mobile-nav a.button {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        .mobile-nav a.button:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        /* Aggiunta per menu mobile - bottone cambia futuro */
        .mobile-nav a.future-button {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
            text-decoration: none;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .mobile-nav a.future-button:hover {
            background-color: #23dd84;
            transform: translateX(5px);
        }

        /* Pagina cambio futuro */
        .future-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .future-page.active {
            opacity: 1;
            visibility: visible;
        }

        .future-frame {
            width: 90%;
            height: 90%;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            background-color: var(--background-green);
        }

        .frame-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('/api/placeholder/1600/900');
            background-size: cover;
            background-position: center;
            filter: blur(10px);
            transform: scale(1.1);
            z-index: 1;
            opacity: 0.5;
        }

        .frame-content {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 3;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .close-button:hover {
            background-color: #e44;
            transform: rotate(90deg);
        }

        /* Header per la calcolatrice */
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 10px;
        }
        
        /* Sezione hero */
        .hero {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .bottle-graphic {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 350px;
        }
        
        .bottle-img {
            width: 200px;
            height: 350px;
        }
        
        .hero-text {
            flex: 1;
            font-size: 48px;
            font-weight: bold;
            color: var(--primary-color);
            line-height: 1.2;
        }
        
        .wave-top {
            margin-top: -50px;
            margin-bottom: -5px;
        }

        /* Stile per la sezione calcolatrice */
        .calculator {
            background-color: var(--light-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }

        .input-section {
            margin-bottom: 20px;
            text-align: center;
        }

        .input-label {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .input-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .input-field {
            width: 120px;
            height: 40px;
            font-size: 18px;
            text-align: center;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            color: var(--primary-color);
            background-color: white;
        }

        .material-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .material-button {
            padding: 8px 15px;
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            background-color: white;
            color: var(--primary-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .material-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .results {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-card {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .result-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .result-label {
            font-size: 14px;
            color: #666;
        }

        .earnings-value {
            font-size: 16px;
            color: var(--accent-color);
            font-weight: bold;
            margin-top: 5px;
        }

        .donated-card {
            background-color: #f7fffa;
        }

        .token-tree-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            height: 50px;
            width: 100%;
            margin-bottom: 10px;
        }

        .token-icon, .tree-icon {
            font-size: 30px;
            position: absolute;
            transition: all 0.5s ease;
        }

        .token-icon {
            transform: translateY(0);
            z-index: 2;
        }

        .tree-icon {
            transform: translateY(0) scale(0.5);
            opacity: 0.5;
            z-index: 1;
        }

        .slider-container {
            width: 100%;
            margin-top: 10px;
        }

        .donation-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 4px;
            outline: none;
        }

        .donation-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--accent-color);
            cursor: pointer;
        }

        .donation-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }

        .tree-counter {
            background-color: rgba(29, 201, 115, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tree-label {
            font-size: 16px;
            color: var(--accent-color);
        }

        .tree-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .total-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
        }

        .stat-card {
            flex: 1;
            background-color: #f0f8ff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .cta-button {
            display: block;
            width: 250px;
            height: 50px;
            margin: 0 auto;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            position: relative;
            z-index: 10;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .button-clicked {
            animation: buttonPulse 0.3s;
        }
        
        @keyframes buttonPulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Animazioni per bottiglia, token e albero */
        #animation-container {
            width: 100%;
            height: 100%;
        }
        
        #bottle-container {
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        
        #token-container {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        #tree-container {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        #animation-container.cycle-animation #bottle-container {
            animation: fadeBottle 9s infinite;
        }
        
        #animation-container.cycle-animation #token-container {
            animation: fadeToken 9s infinite;
        }
        
        #animation-container.cycle-animation #tree-container {
            animation: fadeTree 9s infinite;
        }
        
        @keyframes fadeBottle {
            0%, 33% { opacity: 1; }
            34%, 66% { opacity: 0; }
            67%, 100% { opacity: 0; }
        }
        
        @keyframes fadeToken {
            0%, 33% { opacity: 0; }
            34%, 66% { opacity: 1; }
            67%, 100% { opacity: 0; }
        }
        
        @keyframes fadeTree {
            0%, 33% { opacity: 0; }
            34%, 66% { opacity: 0; }
            67%, 100% { opacity: 1; }
        }

        /* Responsive per dispositivi mobili */
        @media (max-width: 768px) {
            .main-nav {
                display: none;
            }
            
            .hamburger-btn {
                display: block;
            }
            
            .mobile-nav.active {
                display: flex;
            }

            .frame-content {
                padding: 10px;
            }
            
            .hero {
                flex-direction: column;
                text-align: center;
            }
            
            .hero-text {
                font-size: 36px;
                margin-top: 20px;
            }
            
            .results {
                flex-direction: column;
            }
            
            .result-card {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .total-stats {
                flex-direction: column;
            }
            
            .stat-card {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .cta-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Intestazione -->
    <header>
        <div class="logo">
            <img src="./assets/img/logo da email.png" alt="Logo">
            <span>SynergyRecycle.B</span>
        </div>
        <nav class="main-nav">
            <!-- Nuovo pulsante cambia futuro -->
            <a href="#" class="future-button" id="future-button">Guarda come puoi cambiare il futuro</a>
            
            <a href="./" class="button">Home</a>
            <a href="./servizi.html" class="button">Servizi</a>
            <a href="./sostenerci.html" class="button">Supportaci</a>
            <a href="./contattaci.html" class="button">Contattaci</a>
            <a href="./roadmap.html" class="button">Roadmap</a>
        </nav>
        <div class="hamburger-container">
            <button id="hamburger-btn" class="hamburger-btn" aria-expanded="false" aria-label="Menu">☰</button>
        </div>
    </header>

    <!-- Navigazione mobile -->
    <nav class="mobile-nav" id="mobile-nav">
        <!-- Nuovo pulsante cambia futuro anche per mobile -->
        <a href="#" class="future-button" id="future-button-mobile">Guarda come puoi cambiare il futuro</a>
        
        <a href="./" class="button">Home</a>
        <a href="./servizi.html" class="button">Servizi</a>
        <a href="./sostenerci.html" class="button">Supportaci</a>
        <a href="./contattaci.html" class="button">Contattaci</a>
        <a href="./roadmap.html" class="button">Roadmap</a>
    </nav>

    <!-- Pagina cambio futuro -->
    <div class="future-page" id="future-page">
        <div class="future-frame">
            <div class="frame-background"></div>
            <div class="close-button" id="close-button">×</div>
            <div class="frame-content" id="future-content">
                <!-- Contenuto fornito - SynergyRecycle.B -->
                <div class="header">
                    <div class="logo">
                        <svg width="30" height="30" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="45" stroke="#006565" stroke-width="5"/>
                            <path d="M50 10 C25 30, 25 70, 50 90" stroke="#006565" stroke-width="5" fill="none"/>
                            <path d="M50 10 C75 30, 75 70, 50 90" stroke="#006565" stroke-width="5" fill="none"/>
                            <circle cx="50" cy="50" r="10" fill="#006565"/>
                        </svg>
                    </div>
                    <div class="logo-text">SynergyRecycle.B</div>
                </div>

                    <div class="main-content">
        <div class="hero">
            <div class="bottle-graphic">
                <svg class="bottle-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 350">
                    <!-- Transition Animation - Bottle to Token to Tree -->
                    <g id="animation-container">
                        <!-- Bottle/Can -->
                        <g id="bottle-container">
                            <!-- Bottle Shape -->
                            <path d="M70 50 L130 50 L130 80 C160 100 170 150 170 200 C170 280 130 320 100 320 C70 320 30 280 30 200 C30 150 40 100 70 80 Z" fill="#A8E6E6"/>
                            <!-- Bottle Cap -->
                            <path d="M75 30 L125 30 L125 50 L75 50 Z" fill="#006565"/>
                            <!-- Bottle Ring -->
                            <path d="M70 50 L130 50 L130 55 L70 55 Z" fill="#8BDFDF"/>
                            <!-- Label -->
                            <path d="M40 150 L160 150 L160 250 L40 250 Z" fill="#6DD2D2"/>
                        </g>
                        
                        <!-- Token -->
                        <g id="token-container" opacity="0">
                            <circle cx="100" cy="175" r="70" fill="#1DC973"/>
                            <text x="100" y="180" font-size="24" fill="white" text-anchor="middle" font-weight="bold">SRb</text>
                            <circle cx="100" cy="175" r="60" stroke="white" stroke-width="3" fill="none"/>
                        </g>
                        
                        <!-- Tree -->
                        <g id="tree-container" opacity="0">
                            <!-- Tree Trunk -->
                            <rect x="90" y="200" width="20" height="100" fill="#8B4513"/>
                            <!-- Tree Leaves -->
                            <path d="M100 50 L30 200 L170 200 Z" fill="#228B22"/>
                            <path d="M100 80 L40 180 L160 180 Z" fill="#2E8B57"/>
                            <path d="M100 110 L50 160 L150 160 Z" fill="#3CB371"/>
                        </g>
                        
                        <!-- Recycling Symbol -->
                        <g id="recycling-symbol">
                            <path d="M100 330 C70 330, 50 310, 50 280 C50 250, 70 230, 100 230" stroke="#1DC973" stroke-width="5" fill="none"/>
                            <path d="M100 230 C130 230, 150 250, 150 280 C150 310, 130 330, 100 330" stroke="#1DC973" stroke-width="5" fill="none"/>
                            <path d="M85 280 L115 280" stroke="#1DC973" stroke-width="5"/>
                            <path d="M85 280 L95 270" stroke="#1DC973" stroke-width="5"/>
                            <path d="M85 280 L95 290" stroke="#1DC973" stroke-width="5"/>
                        </g>
                    </g>
                </svg>
            </div>
            <div class="hero-text">
                Recycle,<br>
                Earn<br>
                Impact<br>
                the World
            </div>
        </div>

        <button class="cta-button" id="calculate-button">Calculate your impact now</button>

        <div class="wave-top">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#EFFBFB" fill-opacity="1" d="M0,32L48,53.3C96,75,192,117,288,122.7C384,128,480,96,576,90.7C672,85,768,107,864,144C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>

        <div class="calculator">
            <div class="input-section">
                <div class="input-label">Enter the number of bottles or cans</div>
                <div class="input-container">
                    <input type="number" id="quantity-input" class="input-field" value="20" min="0">
                </div>
                <div class="material-toggle">
                    <button class="material-button active" id="pet-button">PET Bottles</button>
                    <button class="material-button" id="can-button">Aluminum Cans</button>
                </div>
            </div>

            <div class="results">
                <div class="result-card">
                    <div class="result-value" id="co2-saved">11</div>
                    <div class="result-label">kg CO<sub>2</sub> Saved</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="tokens-earned">3.5</div>
                    <div class="result-label">SRb Earned</div>
                    <div class="earnings-value" id="money-earned">€0.08</div>
                </div>
                <div class="result-card donated-card">
                    <div class="token-tree-container">
                        <div class="token-icon">🪙</div>
                        <div class="tree-icon">🌳</div>
                    </div>
                    <div class="result-label">Donated</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="donation-slider" id="donation-slider">
                        <div class="donation-info">
                            <span id="donated-amount">1.8 SRb</span>
                            <span>Touttree</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tree-counter" id="tree-counter">
                <div class="tree-label">Trees planted from this donation:</div>
                <div class="tree-value" id="tree-value">0</div>
            </div>

            <div class="total-stats">
                <div class="stat-card">
                    <div class="stat-value" id="recycled-counter">1,240,560</div>
                    <div class="stat-label">Items Recycled</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-co2-saved">198,490</div>
                    <div class="stat-label">kg CO<sub>2</sub> Saved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-trees">113</div>
                    <div class="stat-label">Trees Planted</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const PET_CO2_SAVING = 90; // grams per bottle
        const CAN_CO2_SAVING = 185; // grams per can
        const TOKEN_VALUE = 0.00223; // € per token
        const TOKENS_PER_TREE = 10911; // tokens needed to plant one tree

        // Global variables
        let totalRecycled = 1240560;
        let totalCO2Saved = 198490;
        let totalTreesPlanted = 113;
        let currentMaterial = 'pet';
        let sessionDonatedTokens = 0;

        // DOM Elements
        const quantityInput = document.getElementById('quantity-input');
        const co2SavedElement = document.getElementById('co2-saved');
        const tokensEarnedElement = document.getElementById('tokens-earned');
        const moneyEarnedElement = document.getElementById('money-earned');
        const donationSlider = document.getElementById('donation-slider');
        const donatedAmountElement = document.getElementById('donated-amount');
        const recycledCounterElement = document.getElementById('recycled-counter');
        const totalCO2SavedElement = document.getElementById('total-co2-saved');
        const totalTreesElement = document.getElementById('total-trees');
        const petButton = document.getElementById('pet-button');
        const canButton = document.getElementById('can-button');
        const treeValueElement = document.getElementById('tree-value');
        const calculateButton = document.getElementById('calculate-button');
        const tokenIcon = document.querySelector('.token-icon');
        const treeIcon = document.querySelector('.tree-icon');

        // Animation elements
        const animationContainer = document.getElementById('animation-container');
        const bottleContainer = document.getElementById('bottle-container');
        const tokenContainer = document.getElementById('token-container');
        const treeContainer = document.getElementById('tree-container');

        // Start animation cycle - versione migliorata
        function startAnimation() {
            // Anziché alternare l'opacità, utilizziamo animazioni CSS
            bottleContainer.classList.add('animated');
            tokenContainer.classList.add('animated');
            treeContainer.classList.add('animated');
            
            // Aggiungiamo anche una classe al contenitore principale
            animationContainer.classList.add('cycle-animation');
        }

        // Configurazione per l'animazione token-albero
        function setupTokenTreeAnimation() {
            // Funzione per aggiornare l'animazione in base al valore dello slider
            function updateTokenTreeAnimation(value) {
                // Calcola la percentuale di donazione (0-100)
                const percentage = value / 100;
                
                // Token Animation - dall'alto verso il basso, gradualmente scompare
                tokenIcon.style.transform = `translateY(${percentage * 30}px) scale(${1 - percentage * 0.5})`;
                tokenIcon.style.opacity = `${1 - percentage * 0.7}`;
                
                // Tree Animation - dal basso verso l'alto, gradualmente appare e cresce
                treeIcon.style.transform = `translateY(-${percentage * 30}px) scale(${0.5 + percentage * 0.5})`;
                treeIcon.style.opacity = `${percentage}`;
            }
            
            // Aggiorniamo l'animazione quando lo slider cambia
            donationSlider.addEventListener('input', function() {
                updateTokenTreeAnimation(this.value);
            });
            
            // Inizializza con il valore attuale dello slider
            updateTokenTreeAnimation(donationSlider.value);
        }

        // Calculate and update results
        function updateResults() {
            const quantity = parseInt(quantityInput.value) || 0;
            
            // Calculate CO2 savings based on material type
            const co2PerUnit = currentMaterial === 'pet' ? PET_CO2_SAVING : CAN_CO2_SAVING;
            const totalCO2 = (quantity * co2PerUnit) / 1000; // Convert to kg
            
            // Calculate tokens earned (1 token per unit)
            const tokensEarned = quantity;
            
            // Calculate money earned
            const moneyEarned = tokensEarned * TOKEN_VALUE;
            
            // Calculate donated amount based on slider percentage
            const donationPercentage = donationSlider.value / 100;
            const donatedTokens = tokensEarned * donationPercentage;
            
            // Update UI
            co2SavedElement.textContent = totalCO2.toFixed(1);
            tokensEarnedElement.textContent = tokensEarned.toFixed(1);
            moneyEarnedElement.textContent = '€' + moneyEarned.toFixed(2);
            donatedAmountElement.textContent = donatedTokens.toFixed(1) + ' SRb';
            
            // Calculate trees planted from current donation
            const treesFromDonation = Math.floor(donatedTokens / TOKENS_PER_TREE);
            treeValueElement.textContent = treesFromDonation;
        }

        // Submit calculation
        function submitCalculation() {
            const quantity = parseInt(quantityInput.value) || 0;
            if (quantity <= 0) return;
            
            // Calculate CO2 savings
            const co2PerUnit = currentMaterial === 'pet' ? PET_CO2_SAVING : CAN_CO2_SAVING;
            const totalCO2 = (quantity * co2PerUnit) / 1000; // Convert to kg
            
            // Calculate tokens and donations
            const tokensEarned = quantity;
            const donationPercentage = donationSlider.value / 100;
            const donatedTokens = tokensEarned * donationPercentage;
            
            // Update global counters
            totalRecycled += quantity;
            totalCO2Saved += totalCO2;
            
            // Add to session donations but calculate trees properly
            sessionDonatedTokens += donatedTokens;
            const newTreesPlanted = Math.floor(sessionDonatedTokens / TOKENS_PER_TREE);
            
            // Calculate the remainder tokens that didn't make a tree
            const remainderTokens = sessionDonatedTokens % TOKENS_PER_TREE;
            
            // Reset session donations to just the remainder
            sessionDonatedTokens = remainderTokens;
            
            // Update total trees planted
            totalTreesPlanted += newTreesPlanted;
            
            // Update UI
            recycledCounterElement.textContent = totalRecycled.toLocaleString();
            totalCO2SavedElement.textContent = totalCO2Saved.toFixed(0).toLocaleString();
            totalTreesElement.textContent = totalTreesPlanted.toLocaleString();
            
            // Reset input
            quantityInput.value = "0";
            updateResults();
        }

        // Funzione per inizializzare tutte le animazioni migliorate
        function initImprovedAnimations() {
            setupTokenTreeAnimation();
            startAnimation();
            updateResults();
        }

        // Event listeners
        quantityInput.addEventListener('input', updateResults);
        
        donationSlider.addEventListener('input', updateResults);
        
        petButton.addEventListener('click', () => {
            currentMaterial = 'pet';
            petButton.classList.add('active');
            canButton.classList.remove('active');
            updateResults();
        });
        
        canButton.addEventListener('click', () => {
            currentMaterial = 'can';
            canButton.classList.add('active');
            petButton.classList.remove('active');
            updateResults();
        });
        
        calculateButton.addEventListener('click', submitCalculation);

        // Inizializza tutto al caricamento
        document.addEventListener('DOMContentLoaded', initImprovedAnimations);
        
        // Se il documento è già caricato, esegui subito
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(initImprovedAnimations, 1);
        }
    </script>
</body>
</html>
